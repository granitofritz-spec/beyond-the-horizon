<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Player Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --ocean:#007c91;
      --teal:#00b3bf;
      --sand:#f0e6d8;
      --sunset:#ff8a65;
      --dark-veil: rgba(0,0,0,0.55);
      --card:#ffffff;
      --muted:#6b7a7a;
      --dark-green: #2e5d4f;
    }
    *{box-sizing:border-box}
    
    html{
      height:100%;
    }
    
    body{
      margin:0;
      font-family:'Work Sans',system-ui,Arial;
      background:var(--sand);
      color:#122;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      height: 100%;
    }
    
    /* --- New Dashboard Layout --- */
    .dashboard-container {
      display: flex;
      height: 100vh;
    }
    
    /* --- Sidebar (Left Column) --- */
    .sidebar {
      width: 240px;
      background: var(--dark-green);
      color: #fff;
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }
    
    .sidebar-user {
      padding: 1.5rem;
      font-weight: 700;
      font-size: 1.2rem;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .sidebar nav {
      display: flex;
      flex-direction: column;
      padding: 1rem 0;
    }
    
    .sidebar-nav-btn {
      background: transparent;
      border: none;
      color: rgba(255,255,255,0.8);
      padding: 1rem 1.5rem;
      text-align: left;
      font-size: 1rem;
      font-weight: 600;
      font-family: 'Work Sans', sans-serif;
      cursor: pointer;
      transition: background 0.2s, color 0.2s;
    }
    
    .sidebar-nav-btn:hover {
      background: rgba(255,255,255,0.05);
      color: #fff;
    }
    
    .sidebar-nav-btn.active {
      background: var(--teal);
      color: #fff;
    }

    /* --- Main Content (Right Column) --- */
    .main-content-wrapper {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden; 
    }
    
    .top-bar {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      padding: 1rem 2rem;
      background: var(--card);
      border-bottom: 1px solid #e0e0e0;
      flex-shrink: 0;
    }
    
    .content-area {
      flex-grow: 1;
      padding: 2rem;
      overflow-y: auto; 
      background: var(--sand);
    }
    
    /* --- Content Pages --- */
    .dashboard-page {
      display: none; 
    }
    
    .dashboard-page.active {
      display: block; 
    }
    
    .content-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
    }
    
    .shop-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 1.5rem;
    }
    
    .shop-items-column {
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
    }

    /* --- General Components --- */
    .btn{display:inline-block;padding:12px 18px;border-radius:999px;text-decoration:none;font-weight:700; border: none; cursor: pointer; transition: background 0.3s;}
    .btn-primary{background:var(--teal);color:#fff}
    .btn-primary:hover{background:#008a96;}
    
    .card{
      background:var(--card);
      padding:1.5rem; 
      border-radius:12px;
      box-shadow:0 6px 18px rgba(10,20,20,0.04);
    }
    .card h2, .card h3, .card h4 {
      margin-top: 0;
      margin-bottom: 1rem;
    }
    
    .small-muted{font-size:0.85rem;color:var(--muted)}

    /* Progress Bar */
    .progress-bar {
      width: 100%;
      height: 10px;
      background: rgba(0,0,0,0.1); 
      border-radius: 10px;
      overflow: hidden;
    }
    .progress {
      height: 100%;
      background: #7ea36a;
      width: 65%;
    }
    
    /* Cart */
    .cart-list{max-height:300px;overflow:auto; margin-bottom: 1rem;}
    .cart-row{display:flex;justify-content:space-between;padding:6px 0;border-bottom:1px dashed rgba(0,0,0,0.08)}
    .cart-row button {
      background: #ff5c5c;
      color: white;
      border: none;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      cursor: pointer;
      line-height: 20px;
    }
    
    /* Store Items */
    .items{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:12px
    }
    .item{padding:12px;border-radius:10px;background:linear-gradient(180deg,#fff,#f7fffd);display:flex;flex-direction:column;gap:8px}
    .item .title{font-weight:700}
    
    .item-image-placeholder {
      width: 100%;
      height: 120px;
      border-radius: 8px;
      background: linear-gradient(180deg,#dfeff0,#bfe0d9);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--muted);
      font-weight: 700;
      margin-bottom: 10px;
    }

    /* Settings Form */
    .form-field {
      margin-bottom: 1rem;
    }
    .form-field label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    .form-field input, .form-field select {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 1rem;
      font-family: 'Work Sans', sans-serif;
    }
    
    /* ADDED: Style for readonly inputs */
    .form-field input[readonly] {
      background: #eee;
      color: #777;
      cursor: not-allowed;
    }
    
    /* Achievements */
    .ach-category {
      margin-bottom: 1.5rem;
    }
    .ach-list {
      list-style: none;
      padding-left: 0;
    }
    .ach-list li {
      padding: 0.5rem 0;
      border-bottom: 1px solid #eee;
    }
    .ach-list li.done {
      color: var(--muted);
      text-decoration: line-through;
    }
    .ach-list li.not-done::before {
      content: '☐';
      margin-right: 10px;
      font-weight: 700;
    }
    .ach-list li.done::before {
      content: '☑';
      margin-right: 10px;
      font-weight: 700;
      color: var(--teal);
    }
    
    /* Responsive */
    @media (max-width: 980px) {
      .shop-grid {
        grid-template-columns: 1fr;
      }
      .sidebar {
        width: 180px;
      }
      .sidebar-user {
        padding: 1rem;
        font-size: 1rem;
      }
      .sidebar-nav-btn {
        padding: 0.8rem 1rem;
        font-size: 0.9rem;
      }
      .content-area {
        padding: 1rem;
      }
      .top-bar {
        padding: 0.5rem 1rem;
      }
    }

    @media (max-width: 768px) {
      .dashboard-container {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        height: auto;
        flex-direction: row;
        border-bottom: 2px solid var(--teal);
      }
      .sidebar-user {
        border-bottom: none;
        border-right: 1px solid rgba(255,255,255,0.1);
      }
      .sidebar nav {
        flex-direction: row;
        flex-grow: 1;
        justify-content: space-around;
      }
      .top-bar {
        display: none;
      }
      #mobile-logout {
        display: block !important;
      }
    }
    
  </style>
</head>
<body>

  <div class="dashboard-container">
    
    <aside class="sidebar">
      <div class="sidebar-user" id="sidebar-welcome">
        Loading...
      </div>
      <nav>
        <button class="sidebar-nav-btn active" data-tab="overview">Overview</button>
        <button class="sidebar-nav-btn" data-tab="achievements">Achievements</button>
        <button class="sidebar-nav-btn" data-tab="shop">Shop</button>
        <button class="sidebar-nav-btn" data-tab="settings">Settings</button>
        <button id="mobile-logout" class="sidebar-nav-btn" style="display: none;">Logout</button>
      </nav>
    </aside>
    
    <div class="main-content-wrapper">
      
      <header class="top-bar">
        <button id="logoutBtn" class="btn" style="background: var(--sunset); color: #fff; padding: 8px 14px; margin: 0; font-size: 0.9rem;">Logout</button>
      </header>
      
      <main class="content-area">
        
        <section id="page-overview" class="dashboard-page active">
          <div class="content-grid">
            <div class="card">
              <h2>Your Progress</h2>
              <div class="progress-bar"><div class="progress"></div></div>
              <p>Level 3 - Explorer</p>
            </div>

            <div class="card">
              <h2>Inventory</h2>
              <p>- Wooden Axe<br>- Coconut Water<br>- Leaf Shelter Blueprint</p>
            </div>

            <div class="card">
              <h2>Map</h2>
              <p>The eastern shore remains unexplored...</p>
            </div>
            
            </div>
        </section>
        
        <section id="page-settings" class="dashboard-page">
          <h2>Settings</h2>
          <div class="content-grid">
            
            <div class="card">
              <h3>Account</h3>
              <div class="form-field">
                <label for="setting-email">Email (Account)</label>
                <input type="email" id="setting-email" readonly>
              </div>
              <div class="form-field">
                <label for="setting-phone">Phone Number</label>
                <input type="tel" id="setting-phone" placeholder="Your phone number">
              </div>
              <div class="form-field">
                <label for="setting-ign">Change IGN (In-Game Name)</label>
                <input type="text" id="setting-ign" placeholder="New IGN">
              </div>
              <button id="save-account-btn" class="btn btn-primary">Save Account Info</button>
            </div>
            
            <div class="card">
              <h3>Security</h3>
              <div class="form-field">
                <label for="setting-pass">New Password</label>
                <input type="password" id="setting-pass" placeholder="New Password">
              </div>
              <div class="form-field">
                <label for="setting-pass-confirm">Confirm Password</label>
                <input type="password" id="setting-pass-confirm" placeholder="Confirm Password">
              </div>
              <button class="btn btn-primary" onclick="alert('Password changed (prototype)')">Change Password</button>
            </div>
            
            <div class="card">
              <h3>Payment</h3>
              <div class="form-field">
                <label for="setting-payment">Payment Method</label>
                <select id="setting-payment">
                  <option value="">-- Select Method --</option>
                  <option value="gcash">GCash</option>
                  <option value="paypal">PayPal</option>
                </select>
              </div>
              <button class="btn btn-primary" onclick="alert('Payment method saved (prototype)')">Save Payment</button>
            </div>

          </div>
        </section>
        
        <section id="page-shop" class="dashboard-page">
          <h2>Shop</h2>
          <div class="shop-grid">
            
            <div class="shop-items-column">
              <div class="card">
                <h3>Weekly Shop</h3>
                <div class="items" id="store-items">
                  </div>
              </div>
              
              <div class="card">
                <h3>Season Battlepass</h3>
                <div class="item card">
                  <div class="item-image-placeholder">Battlepass Banner</div>
                  <div style="display:flex;justify-content:space-between;align-items:center">
                    <div>
                      <div class="title">Season 1 Battlepass</div>
                      <div class="small-muted">Unlock 100 Tiers</div>
                    </div>
                    <div style="text-align:right">₱350</div>
                  </div>
                  <div style="margin-top:auto;display:flex;gap:8px;justify-content:flex-end">
                    <button class="btn btn-primary add-cart" data-id="bp1">Add to Cart</button>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="sidebar-content">
              <div class="card">
                <h4>Your Cart</h4>
                <div class="cart-list" id="cart-list">(cart empty)</div>
                <div style="margin-top:12px;display:flex;justify-content:space-between;align-items:center">
                  <strong id="cart-total">Total: ₱0</strong>
                  <button id="checkout" class="btn btn-primary">Checkout</button>
                </div>
              </div>
              
              <div class="card">
                <h4>Payment</h4>
                <p class="small-muted">Your saved payment method will be used.</p>
                <button class="btn btn-primary" style="width: 100%;" onclick="alert('Proceeding to secure payment (prototype)...')">Proceed to Payment</button>
              </div>
            </div>
            
          </div>
        </section>
        
        <section id="page-achievements" class="dashboard-page">
          <h2>Achievements</h2>
          <div class="content-grid">
            
            <div class="card">
              <h3>Missions</h3>
              <ul class="ach-list">
                <li class="done">Craft your first tool</li>
                <li class="done">Build a shelter</li>
                <li class="not-done">Reach the other side of the island</li>
              </ul>
            </div>
            
            <div class="card">
              <h3>Easter Eggs</h3>
              <ul class="ach-list">
                <li class="done">Found the message in a bottle</li>
                <li class="not-done">Discovered the hidden waterfall cave</li>
              </ul>
            </div>
            
            <div class="card" style="grid-column: 1 / -1;">
              <h3>Achievement Log</h3>
              
              <div class="ach-category">
                <h4>Common</h4>
                <ul class="ach-list">
                  <li class="done">Chop 10 trees</li>
                  <li class="done">Catch 5 fish</li>
                  <li class="not-done">Survive 3 days</li>
                </ul>
              </div>
              
              <div class="ach-category">
                <h4>Uncommon</h4>
                <ul class="ach-list">
                  <li class="done">Craft a backpack</li>
                  <li class="not-done">Build a wooden foundation</li>
                </ul>
              </div>
              
              <div class="ach-category">
                <h4>Rare</h4>
                <ul class="ach-list">
                  <li class="not-done">Tame a boar</li>
                  <li class="not-done">Find the ancient ruins</li>
                </ul>
              </div>
            </div>
            
          </div>
        </section>
        
      </main>
      
    </div>
    
  </div>

  <script>
    // --- Auth Check ---
    // MODIFIED: 'loggedInUser' is now the email
    const userEmail = localStorage.getItem('loggedInUser');
    const userData = userEmail ? JSON.parse(localStorage.getItem(userEmail)) : null;

    if (!userEmail || !userData) {
      window.location.href = 'login.html'; // Redirect to login
    } else {
      // MODIFIED: Use IGN for welcome, populate settings
      document.getElementById('sidebar-welcome').textContent = `User: ${userData.username}`;
      document.getElementById('setting-ign').value = userData.username || '';
      document.getElementById('setting-email').value = userEmail;
      document.getElementById('setting-phone').value = userData.phone || '';
    }

    // --- Logout Logic ---
    function logout() {
      localStorage.removeItem('loggedInUser');
      window.location.href = 'index.html'; // Logout redirects to home
    }
    document.getElementById('logoutBtn').onclick = logout;
    document.getElementById('mobile-logout').onclick = logout;

    // --- Tab Switching Logic ---
    const navButtons = document.querySelectorAll('.sidebar-nav-btn');
    const contentPages = document.querySelectorAll('.dashboard-page');
    
    navButtons.forEach(btn => {
      if (btn.id === 'mobile-logout') return; 
      
      btn.addEventListener('click', () => {
        const tab = btn.dataset.tab;
        navButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        contentPages.forEach(page => {
          page.classList.toggle('active', page.id === `page-${tab}`);
        });
      });
    });
    
    // --- Settings Save Logic ---
    document.getElementById('save-account-btn').onclick = () => {
      if (!userEmail || !userData) return; // Should not happen
      
      // Get new values
      const newIgn = document.getElementById('setting-ign').value;
      const newPhone = document.getElementById('setting-phone').value;
      
      // Update data object
      userData.username = newIgn;
      userData.phone = newPhone;
      
      // Save back to localStorage
      localStorage.setItem(userEmail, JSON.stringify(userData));
      
      // Update UI
      document.getElementById('sidebar-welcome').textContent = `User: ${newIgn}`;
      alert('Account info saved (prototype)');
    };

    // --- Store & Cart Logic ---
    const SAMPLE_ITEMS = [
      {id:'up1',title:'Backpack Upgrade',desc:'Increase carry capacity',price:120,cat:'Upgrades'},
      {id:'up2',title:'Sturdier Axe',desc:'Chop faster',price:200,cat:'Upgrades'},
      {id:'rw1',title:'Survivor Starter Pack',desc:'Starter resources bundle',price:80,cat:'Rewards'},
    ];
    let CART = JSON.parse(localStorage.getItem('bth_cart')||'[]');
    
    function saveCart(){ 
      localStorage.setItem('bth_cart', JSON.stringify(CART)); 
      renderCart(); 
    }
    
    function renderCart(){
      const list = document.getElementById('cart-list'); 
      list.innerHTML=''; 
      if(CART.length===0){ 
        list.textContent='(cart empty)'; 
        document.getElementById('cart-total').textContent='Total: ₱0'; 
        return; 
      }
      
      let total=0; 
      const allItems = [...SAMPLE_ITEMS, {id:'bp1',title:'Season 1 Battlepass',price:350}];
      
      CART.forEach(ci=>{ 
        const it = allItems.find(s=>s.id===ci.id); 
        if (!it) return;
        total+=it.price*ci.qty; 
        const row = document.createElement('div'); 
        row.className='cart-row'; 
        row.innerHTML = `<div>${it.title} x${ci.qty}</div><div>₱${it.price*ci.qty} <button data-remove=\"${ci.id}\">✕</button></div>`; 
        list.appendChild(row); 
      });
      document.getElementById('cart-total').textContent = `Total: ₱${total}`;
      
      list.querySelectorAll('[data-remove]').forEach(b=>b.addEventListener('click',()=>{ 
        const id=b.dataset.remove; 
        CART = CART.filter(x=>x.id!==id); 
        saveCart(); 
      }));
    }
    
    document.getElementById('checkout').addEventListener('click', ()=>{ 
      if(CART.length===0){ alert('Cart empty'); return;} 
      alert('Proceeding to checkout (prototype)...'); 
      CART=[]; 
      saveCart(); 
    });
    
    // Populate store items
    const storeEl = document.getElementById('store-items');
    SAMPLE_ITEMS.forEach(it=>{
      const div = document.createElement('div'); div.className='item card';
      div.innerHTML = `<div class=\"item-image-placeholder\">Item Image</div><div style=\"display:flex;justify-content:space-between;align-items:center\"><div><div class=\"title\">${it.title}</div><div class=\"small-muted\">${it.cat}</div></div><div style=\"text-align:right\">₱${it.price}</div></div><div class=\"small-muted\">${it.desc}</div><div style=\"margin-top:auto;display:flex;gap:8px;justify-content:flex-end\"><button class=\"btn btn-primary add-cart\" data-id=\"${it.id}\">Add to Cart</button></div>`;
      storeEl.appendChild(div);
    });

    // Event listener for "Add to Cart" buttons
    document.body.addEventListener('click', e=>{
      if(e.target.classList.contains('add-cart')){
        const id=e.target.dataset.id; 
        const found=CART.find(x=>x.id===id);
        
        if (id === 'bp1' && found) {
          alert('Battlepass is already in your cart.');
          return;
        }
        
        if(found) found.qty++; else CART.push({id,qty:1}); 
        saveCart();
        e.target.textContent = 'Added!';
        setTimeout(()=> { e.target.textContent = 'Add to Cart'; }, 1000);
      }
    });

    // Initial cart render on page load
    renderCart();

  </script>
</body>
</html>